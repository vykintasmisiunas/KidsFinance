<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Money Planner 💰</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Money Planner">
    <meta name="description" content="Track your money month by month - Kids Money Planner">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwIDEwLTQuNDggMTAtMTBTMTcuNTIgMiAxMiAyem0tMiAxNWwtNS01aDNWOGg0djRoM2wtNSA1eiIvPgo8L3N2Zz4KPC9zdmc+">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzY2N2VlYSIvPgo8dGV4dCB4PSIxNiIgeT0iMjIiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfkrA8L3RleHQ+Cjwvc3ZnPg==">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIktpZHMgTW9uZXkgUGxhbm5lciIsCiAgInNob3J0X25hbWUiOiAiTW9uZXkgUGxhbm5lciIsCiAgImRlc2NyaXB0aW9uIjogIlRyYWNrIHlvdXIgbW9uZXkgbW9udGggYnkgbW9udGgiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiM2NjdlZWEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVGt5SWlCb1pXbG5hSFE5SWpFNU1pSWdkbWxsZDBKdmVEMGlNQ0F3SURFNU1pQXhPVElpSUdacGJHdzlJbTV2Ym1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0NqeHlaV04wSUhkcFpIUm9QU0l4T1RJaUlHaGxhV2RvZEQwaU1Ua3lJaUJ5ZUQwaU1qUWlJR1pwYkd3OUlpTTJOamRsWldFaUx6NEtQSE4yWnlCNFBTSTBPQ0lnZVQwaU5EZ2lJSGRwWkhSb1BTSTVOaUlnYUdWcFoyaDBQU0k1TmlJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElpQm1hV3hzUFNKM2FHbDBaU0krQ2p4d1lYUm9JR1E5SWsweE1pQXlRelo0TkRnZ01pQXlJRFl1TkRnZ01pQXhNaUF5Y3pRdU5EZ2dNVEFnTVRBZ01UQWdNVEFnTVRBdE5DNDBPQ0F4TUMweE1DMHhNQzB4TUZNeE55NDFNaUF5SURFeUlESjZiUzB5SURFMWJDMDFMVFZvTTFZNGFEUjJOR2d6YkMwMUlEVjZJaTgrQ2p3dmMzWm5QZ284TDNOMlp6NEsiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5USXhJaUJvWldsbmFIUTlJalV5TVNJZ2RtbGxkMEp2ZUQwaU1DQXdJRFV5TVNBMU1qRWlJR1pwYkd3OUltNXZibVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrQ2p4eVpXTjBJSGRwWkhSb1BTSTFNakVpSUdobGFXZG9kRDBpTlRJeElpQnllRDBpTmpRaUlHWnBiR3c5SWlNMk5qZGxaV0VpTHo0S1BIUmxlSFFnZUQwaU1UWWlJSGs5SWpJeUlpQm1iMjUwTFdaaGJXbHNlVDBpUVhKcFlXd2lJR1p2Ym5RdGMybDZaVDBpTVRnaUlHWnBiR3c5SW5kb2FYUmxJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsSWo3d240S3dQQzlwWlhoMFBnbzhMM04yWno0PSIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Fredoka', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .bounce-in { animation: bounceIn 0.6s ease-out; }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* PWA Install Button */
        .install-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }
        
        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f59e0b;
            color: white;
            text-align: center;
            padding: 8px;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen p-4">
    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        📱 You're offline - but your data is still saved locally!
    </div>

    <!-- PWA Install Button -->
    <button id="installButton" class="install-button bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-colors">
        📱 Install App
    </button>

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">💰 Kids Money Planner 💰</h1>
            <p class="text-xl text-purple-100">Track your money month by month!</p>
            <div id="dataStatus" class="text-sm text-purple-200 mt-2">
                💾 Data automatically saved on your device
            </div>
        </div>

        <!-- Month Selector -->
        <div class="bg-white rounded-3xl p-6 mb-8 card-shadow">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">📅 Current Month</h2>
                <div class="flex items-center space-x-4">
                    <button onclick="changeMonth(-1)" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-xl">← Previous</button>
                    <div class="text-xl font-bold text-gray-800" id="currentMonth"></div>
                    <button onclick="changeMonth(1)" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-xl">Next →</button>
                </div>
            </div>
        </div>

        <!-- Account Balances -->
        <div class="bg-white rounded-3xl p-6 mb-8 card-shadow">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">💳 Account Balances</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-red-100 rounded-2xl p-4 text-center">
                    <div class="text-3xl mb-2">🛍️</div>
                    <div class="text-sm text-red-600 font-medium">Expenses Account</div>
                    <div class="text-lg font-bold text-red-700" id="expensesBalance">$0.00</div>
                    <div class="text-xs text-red-600 mt-1">💵 Cash: <span id="expensesCash">$0.00</span></div>
                    <div class="text-xs text-red-600">🏦 Account: <span id="expensesAccount">$0.00</span></div>
                </div>
                <div class="bg-blue-100 rounded-2xl p-4 text-center">
                    <div class="text-3xl mb-2">🏦</div>
                    <div class="text-sm text-blue-600 font-medium">Savings Account</div>
                    <div class="text-lg font-bold text-blue-700" id="savingsBalance">$0.00</div>
                    <div class="text-xs text-blue-600 mt-1">💵 Cash: <span id="savingsCash">$0.00</span></div>
                    <div class="text-xs text-blue-600">🏦 Account: <span id="savingsAccount">$0.00</span></div>
                </div>
                <div class="bg-purple-100 rounded-2xl p-4 text-center">
                    <div class="text-3xl mb-2">📈</div>
                    <div class="text-sm text-purple-600 font-medium">Investments Account</div>
                    <div class="text-lg font-bold text-purple-700" id="investmentsBalance">$0.00</div>
                    <div class="text-xs text-purple-600 mt-1">💵 Cash: <span id="investmentsCash">$0.00</span></div>
                    <div class="text-xs text-purple-600">🏦 Account: <span id="investmentsAccount">$0.00</span></div>
                </div>
            </div>
        </div>

        <!-- Monthly Cash Flow Summary -->
        <div class="bg-white rounded-3xl p-6 mb-8 card-shadow">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">📊 This Month's Cash Flow</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-red-100 rounded-2xl p-4 text-center">
                    <div class="text-3xl mb-2">🛍️</div>
                    <div class="text-sm text-red-600 font-medium">Expenses Account</div>
                    <div class="text-xs text-green-600 mt-1">+<span id="expensesIncome">$0.00</span></div>
                    <div class="text-xs text-red-600">-<span id="expensesPayments">$0.00</span></div>
                    <div class="text-lg font-bold text-red-700 mt-1" id="expensesNet">$0.00</div>
                </div>
                <div class="bg-blue-100 rounded-2xl p-4 text-center">
                    <div class="text-3xl mb-2">🏦</div>
                    <div class="text-sm text-blue-600 font-medium">Savings Account</div>
                    <div class="text-xs text-green-600 mt-1">+<span id="savingsIncome">$0.00</span></div>
                    <div class="text-xs text-red-600">-<span id="savingsPayments">$0.00</span></div>
                    <div class="text-lg font-bold text-blue-700 mt-1" id="savingsNet">$0.00</div>
                </div>
                <div class="bg-purple-100 rounded-2xl p-4 text-center">
                    <div class="text-3xl mb-2">📈</div>
                    <div class="text-sm text-purple-600 font-medium">Investments Account</div>
                    <div class="text-xs text-green-600 mt-1">+<span id="investmentsIncome">$0.00</span></div>
                    <div class="text-xs text-red-600">-<span id="investmentsPayments">$0.00</span></div>
                    <div class="text-lg font-bold text-purple-700 mt-1" id="investmentsNet">$0.00</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Income Section -->
            <div class="bg-white rounded-3xl p-6 card-shadow">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">💸 Add Income</h2>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Income Source 💰</label>
                        <select id="incomeSource" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            <option value="Dad">From Dad 👨</option>
                            <option value="Mom">From Mom 👩</option>
                            <option value="Allowance">Weekly Allowance 📅</option>
                            <option value="Chores">Chores 🧹</option>
                            <option value="Gift">Gift Money 🎁</option>
                            <option value="Other">Other 💫</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount 💵</label>
                        <input type="number" id="incomeAmount" placeholder="0.00" step="0.01" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Allocate to Account 🎯</label>
                        <select id="incomeAccount" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            <option value="expenses">Expenses Account 🛍️</option>
                            <option value="savings">Savings Account 🏦</option>
                            <option value="investments">Investments Account 📈</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Money Type 💳</label>
                        <select id="incomeType" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            <option value="cash">Cash 💵</option>
                            <option value="account">Bank Account 🏦</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date 📅</label>
                        <input type="date" id="incomeDate" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                    </div>
                </div>

                <button onclick="addIncome()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl transition-colors">
                    ➕ Add Income
                </button>

                <div class="mt-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">📝 This Month's Income</h3>
                    <div id="incomeList" class="space-y-2 max-h-60 overflow-y-auto">
                        <div class="text-gray-500 text-center py-4">No income added yet! 💰</div>
                    </div>
                </div>
            </div>

            <!-- Payments Section -->
            <div class="bg-white rounded-3xl p-6 card-shadow">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">🛒 Add Payment</h2>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">What did you buy? 🛍️</label>
                        <input type="text" id="expenseItem" placeholder="Candy, toy, snack..." class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category 📂</label>
                        <select id="expenseCategory" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            <option value="Food">Food & Snacks 🍕</option>
                            <option value="Toys">Toys & Games 🎮</option>
                            <option value="Clothes">Clothes 👕</option>
                            <option value="Books">Books & School 📚</option>
                            <option value="Entertainment">Entertainment 🎬</option>
                            <option value="Other">Other 💫</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount 💵</label>
                        <input type="number" id="expenseAmount" placeholder="0.00" step="0.01" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pay from Account 🎯</label>
                        <select id="paymentAccount" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            <option value="expenses">Expenses Account 🛍️</option>
                            <option value="savings">Savings Account 🏦</option>
                            <option value="investments">Investments Account 📈</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Payment Type 💳</label>
                        <select id="paymentType" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                            <option value="cash">Cash 💵</option>
                            <option value="account">Bank Account 🏦</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date 📅</label>
                        <input type="date" id="expenseDate" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none">
                    </div>
                </div>

                <button onclick="addExpense()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl transition-colors">
                    ➕ Add Payment
                </button>

                <div class="mt-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">📝 This Month's Payments</h3>
                    <div id="expensesList" class="space-y-2 max-h-60 overflow-y-auto">
                        <div class="text-gray-500 text-center py-4">No payments yet! 🎉</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Yearly Analysis Table -->
        <div class="bg-white rounded-3xl p-6 card-shadow mt-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">📈 Yearly Analysis</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="text-left py-3 px-2 font-bold text-gray-700">Month</th>
                            <th class="text-center py-3 px-2 font-bold text-red-600">🛍️ Expenses</th>
                            <th class="text-center py-3 px-2 font-bold text-blue-600">🏦 Savings</th>
                            <th class="text-center py-3 px-2 font-bold text-purple-600">📈 Investments</th>
                            <th class="text-center py-3 px-2 font-bold text-gray-700">Total</th>
                        </tr>
                        <tr class="text-xs text-gray-500">
                            <th class="text-left py-1 px-2"></th>
                            <th class="text-center py-1 px-2">In | Out | Net</th>
                            <th class="text-center py-1 px-2">In | Out | Net</th>
                            <th class="text-center py-1 px-2">In | Out | Net</th>
                            <th class="text-center py-1 px-2">In | Out | Net</th>
                        </tr>
                    </thead>
                    <tbody id="yearlyAnalysisTable">
                        <!-- Table content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        let currentDate = new Date();
        let monthlyData = {};
        let deferredPrompt;

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICdraWRzLW1vbmV5LXBsYW5uZXItdjEnOwpjb25zdCB1cmxzVG9DYWNoZSA9IFsKICAnLycsCiAgJy9pbmRleC5odG1sJywKICAnL21hbmlmZXN0Lmpzb24nCl07CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBldmVudCA9PiB7CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLm9wZW4oQ0FDSEVfTkFNRSkKICAgICAgLnRoZW4oY2FjaGUgPT4gewogICAgICAgIHJldHVybiBjYWNoZS5hZGRBbGwodXJsc1RvQ2FjaGUpOwogICAgICB9KQogICk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KQogICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpOwogICAgICB9KQogICk7Cn0pOw==')
                .then(registration => {
                    console.log('SW registered: ', registration);
                })
                .catch(registrationError => {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installButton').style.display = 'block';
        });

        document.getElementById('installButton').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('installButton').style.display = 'none';
                }
                deferredPrompt = null;
            }
        });

        // Online/Offline Status
        window.addEventListener('online', () => {
            document.getElementById('offlineIndicator').style.display = 'none';
        });

        window.addEventListener('offline', () => {
            document.getElementById('offlineIndicator').style.display = 'block';
        });

        // Local Storage Functions
        function saveData() {
            try {
                localStorage.setItem('kidsMoneyPlannerData', JSON.stringify(monthlyData));
                document.getElementById('dataStatus').textContent = '💾 Data saved automatically!';
                setTimeout(() => {
                    document.getElementById('dataStatus').textContent = '💾 Data automatically saved on your device';
                }, 2000);
            } catch (error) {
                console.error('Error saving data:', error);
                document.getElementById('dataStatus').textContent = '⚠️ Error saving data';
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('kidsMoneyPlannerData');
                if (savedData) {
                    monthlyData = JSON.parse(savedData);
                    document.getElementById('dataStatus').textContent = '💾 Data loaded from your device';
                }
            } catch (error) {
                console.error('Error loading data:', error);
                monthlyData = {};
            }
        }

        function getCurrentMonthKey() {
            return `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
        }

        function initializeMonth() {
            const monthKey = getCurrentMonthKey();
            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = {
                    income: [],
                    expenses: [],
                    accounts: {
                        expenses: { cash: 0, account: 0 },
                        savings: { cash: 0, account: 0 },
                        investments: { cash: 0, account: 0 }
                    }
                };
                saveData();
            }
        }

        function updateMonthDisplay() {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Set default dates to current month
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('incomeDate').value = dateString;
            document.getElementById('expenseDate').value = dateString;
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            initializeMonth();
            updateMonthDisplay();
            updateAllDisplays();
        }

        function addIncome() {
            const source = document.getElementById('incomeSource').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const account = document.getElementById('incomeAccount').value;
            const type = document.getElementById('incomeType').value;
            const date = document.getElementById('incomeDate').value;
            
            if (amount > 0 && date) {
                const monthKey = getCurrentMonthKey();
                const income = {
                    source: source,
                    amount: amount,
                    account: account,
                    type: type,
                    date: date
                };
                
                monthlyData[monthKey].income.push(income);
                monthlyData[monthKey].accounts[account][type] += amount;
                
                // Clear inputs
                document.getElementById('incomeAmount').value = '';
                
                updateAllDisplays();
                saveData();
            }
        }

        function addExpense() {
            const item = document.getElementById('expenseItem').value.trim();
            const category = document.getElementById('expenseCategory').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const account = document.getElementById('paymentAccount').value;
            const type = document.getElementById('paymentType').value;
            const date = document.getElementById('expenseDate').value;
            
            if (item && amount > 0 && date) {
                const monthKey = getCurrentMonthKey();
                
                // Check if account has sufficient balance
                if (monthlyData[monthKey].accounts[account][type] >= amount) {
                    const expense = {
                        item: item,
                        category: category,
                        amount: amount,
                        account: account,
                        type: type,
                        date: date
                    };
                    
                    monthlyData[monthKey].expenses.push(expense);
                    monthlyData[monthKey].accounts[account][type] -= amount;
                    
                    // Clear inputs
                    document.getElementById('expenseItem').value = '';
                    document.getElementById('expenseAmount').value = '';
                    
                    updateAllDisplays();
                    saveData();
                } else {
                    alert(`Not enough money in ${account} ${type}! Available: $${monthlyData[monthKey].accounts[account][type].toFixed(2)}`);
                }
            }
        }

        function updateAllDisplays() {
            const monthKey = getCurrentMonthKey();
            const data = monthlyData[monthKey];
            
            // Recalculate all account balances from scratch based on transactions
            // Reset all account balances to zero first
            Object.keys(monthlyData).forEach(month => {
                monthlyData[month].accounts = {
                    expenses: { cash: 0, account: 0 },
                    savings: { cash: 0, account: 0 },
                    investments: { cash: 0, account: 0 }
                };
            });
            
            // Recalculate balances from all transactions
            Object.keys(monthlyData).forEach(month => {
                const monthData = monthlyData[month];
                
                // Add income
                monthData.income.forEach(item => {
                    monthData.accounts[item.account][item.type] += item.amount;
                });
                
                // Subtract expenses
                monthData.expenses.forEach(item => {
                    monthData.accounts[item.account][item.type] -= item.amount;
                });
            });
            
            // Calculate cumulative account balances across all months
            const cumulativeBalances = {
                expenses: { cash: 0, account: 0 },
                savings: { cash: 0, account: 0 },
                investments: { cash: 0, account: 0 }
            };
            
            Object.keys(monthlyData).forEach(month => {
                cumulativeBalances.expenses.cash += monthlyData[month].accounts.expenses.cash;
                cumulativeBalances.expenses.account += monthlyData[month].accounts.expenses.account;
                cumulativeBalances.savings.cash += monthlyData[month].accounts.savings.cash;
                cumulativeBalances.savings.account += monthlyData[month].accounts.savings.account;
                cumulativeBalances.investments.cash += monthlyData[month].accounts.investments.cash;
                cumulativeBalances.investments.account += monthlyData[month].accounts.investments.account;
            });
            
            // Update account balances with cumulative totals
            ['expenses', 'savings', 'investments'].forEach(accountType => {
                const totalBalance = cumulativeBalances[accountType].cash + cumulativeBalances[accountType].account;
                document.getElementById(`${accountType}Balance`).textContent = `$${totalBalance.toFixed(2)}`;
                document.getElementById(`${accountType}Cash`).textContent = `$${cumulativeBalances[accountType].cash.toFixed(2)}`;
                document.getElementById(`${accountType}Account`).textContent = `$${cumulativeBalances[accountType].account.toFixed(2)}`;
            });
            
            // Calculate monthly cash flow by account
            const accountCashFlow = {
                expenses: { income: 0, payments: 0 },
                savings: { income: 0, payments: 0 },
                investments: { income: 0, payments: 0 }
            };
            
            // Calculate income by account
            data.income.forEach(item => {
                accountCashFlow[item.account].income += item.amount;
            });
            
            // Calculate payments by account
            data.expenses.forEach(item => {
                accountCashFlow[item.account].payments += item.amount;
            });
            
            // Update cash flow displays
            ['expenses', 'savings', 'investments'].forEach(account => {
                const income = accountCashFlow[account].income;
                const payments = accountCashFlow[account].payments;
                const net = income - payments;
                
                document.getElementById(`${account}Income`).textContent = `$${income.toFixed(2)}`;
                document.getElementById(`${account}Payments`).textContent = `$${payments.toFixed(2)}`;
                document.getElementById(`${account}Net`).textContent = `$${net.toFixed(2)}`;
                
                // Update net flow color
                const netElement = document.getElementById(`${account}Net`);
                if (net < 0) {
                    netElement.className = 'font-bold text-red-600';
                } else if (net > 0) {
                    netElement.className = 'font-bold text-green-600';
                } else {
                    netElement.className = 'font-bold text-gray-600';
                }
            });
            
            // Update lists
            updateIncomeList();
            updateExpensesList();
            
            // Update yearly analysis
            updateYearlyAnalysis();
        }

        function updateIncomeList() {
            const monthKey = getCurrentMonthKey();
            const incomeList = document.getElementById('incomeList');
            const income = monthlyData[monthKey].income;
            
            if (income.length === 0) {
                incomeList.innerHTML = '<div class="text-gray-500 text-center py-4">No income added yet! 💰</div>';
                return;
            }
            
            const accountEmojis = {
                expenses: '🛍️',
                savings: '🏦',
                investments: '📈'
            };
            
            let html = '';
            for (let i = 0; i < income.length; i++) {
                const item = income[i];
                html += `
                <div class="flex justify-between items-center bg-green-50 rounded-lg p-3 bounce-in">
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${item.source} → ${accountEmojis[item.account]} ${item.account}</div>
                        <div class="text-sm text-gray-500">${new Date(item.date).toLocaleDateString()} • ${item.type === 'cash' ? '💵 Cash' : '🏦 Account'}</div>
                    </div>
                    <div class="font-bold text-green-600 mr-3">+$${item.amount.toFixed(2)}</div>
                    <button onclick="deleteIncomeByIndex(${i})" class="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-2 rounded-lg transition-colors font-bold">
                        🗑️ Delete
                    </button>
                </div>
                `;
            }
            incomeList.innerHTML = html;
        }

        function updateExpensesList() {
            const monthKey = getCurrentMonthKey();
            const expensesList = document.getElementById('expensesList');
            const expenses = monthlyData[monthKey].expenses;
            
            if (expenses.length === 0) {
                expensesList.innerHTML = '<div class="text-gray-500 text-center py-4">No payments yet! 🎉</div>';
                return;
            }
            
            const accountEmojis = {
                expenses: '🛍️',
                savings: '🏦',
                investments: '📈'
            };
            
            let html = '';
            for (let i = 0; i < expenses.length; i++) {
                const item = expenses[i];
                html += `
                <div class="flex justify-between items-center bg-red-50 rounded-lg p-3 bounce-in">
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${item.item} (${accountEmojis[item.account]} ${item.account})</div>
                        <div class="text-sm text-gray-500">${item.category} • ${new Date(item.date).toLocaleDateString()} • ${item.type === 'cash' ? '💵 Cash' : '🏦 Account'}</div>
                    </div>
                    <div class="font-bold text-red-600 mr-3">-$${item.amount.toFixed(2)}</div>
                    <button onclick="deleteExpenseByIndex(${i})" class="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-2 rounded-lg transition-colors font-bold">
                        🗑️ Delete
                    </button>
                </div>
                `;
            }
            expensesList.innerHTML = html;
        }

        function showCustomConfirm(message, onConfirm, onCancel) {
            // Create custom confirmation dialog
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            overlay.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-sm mx-4 shadow-2xl">
                    <div class="text-lg font-bold text-gray-800 mb-4">${message}</div>
                    <div class="flex space-x-3">
                        <button id="confirmYes" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl">
                            Yes, Delete
                        </button>
                        <button id="confirmNo" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-xl">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            document.getElementById('confirmYes').onclick = () => {
                document.body.removeChild(overlay);
                onConfirm();
            };
            
            document.getElementById('confirmNo').onclick = () => {
                document.body.removeChild(overlay);
                onCancel();
            };
        }

        function deleteIncomeByIndex(index) {
            const monthKey = getCurrentMonthKey();
            
            showCustomConfirm(
                'Are you sure you want to delete this income entry?',
                () => {
                    // Remove the item at the specific index
                    monthlyData[monthKey].income.splice(index, 1);
                    updateAllDisplays();
                    saveData();
                },
                () => {
                    // User cancelled - do nothing
                }
            );
        }

        function deleteExpenseByIndex(index) {
            const monthKey = getCurrentMonthKey();
            
            showCustomConfirm(
                'Are you sure you want to delete this payment entry?',
                () => {
                    // Remove the item at the specific index
                    monthlyData[monthKey].expenses.splice(index, 1);
                    updateAllDisplays();
                    saveData();
                },
                () => {
                    // User cancelled - do nothing
                }
            );
        }

        function updateYearlyAnalysis() {
            const currentYear = currentDate.getFullYear();
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            
            const yearlyAnalysisTable = document.getElementById('yearlyAnalysisTable');
            let tableHTML = '';
            
            // Calculate totals for the year
            let yearTotals = {
                expenses: { income: 0, payments: 0 },
                savings: { income: 0, payments: 0 },
                investments: { income: 0, payments: 0 }
            };
            
            // Generate rows for each month of the current year
            for (let month = 0; month < 12; month++) {
                const monthKey = `${currentYear}-${String(month + 1).padStart(2, '0')}`;
                const monthData = monthlyData[monthKey];
                
                // Calculate monthly cash flow by account
                const monthCashFlow = {
                    expenses: { income: 0, payments: 0 },
                    savings: { income: 0, payments: 0 },
                    investments: { income: 0, payments: 0 }
                };
                
                if (monthData) {
                    // Calculate income by account
                    monthData.income.forEach(item => {
                        monthCashFlow[item.account].income += item.amount;
                        yearTotals[item.account].income += item.amount;
                    });
                    
                    // Calculate payments by account
                    monthData.expenses.forEach(item => {
                        monthCashFlow[item.account].payments += item.amount;
                        yearTotals[item.account].payments += item.amount;
                    });
                }
                
                // Calculate nets
                const expensesNet = monthCashFlow.expenses.income - monthCashFlow.expenses.payments;
                const savingsNet = monthCashFlow.savings.income - monthCashFlow.savings.payments;
                const investmentsNet = monthCashFlow.investments.income - monthCashFlow.investments.payments;
                const totalNet = expensesNet + savingsNet + investmentsNet;
                
                // Determine if this is the current month
                const isCurrentMonth = month === currentDate.getMonth();
                const rowClass = isCurrentMonth ? 'bg-purple-50 font-medium' : 'hover:bg-gray-50';
                
                tableHTML += `
                    <tr class="${rowClass} border-b border-gray-100">
                        <td class="py-2 px-2 font-medium">${monthNames[month]} ${currentYear}</td>
                        <td class="py-2 px-2 text-center text-xs">
                            <span class="text-green-600">$${monthCashFlow.expenses.income.toFixed(0)}</span> | 
                            <span class="text-red-600">$${monthCashFlow.expenses.payments.toFixed(0)}</span> | 
                            <span class="font-bold ${expensesNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${expensesNet.toFixed(0)}</span>
                        </td>
                        <td class="py-2 px-2 text-center text-xs">
                            <span class="text-green-600">$${monthCashFlow.savings.income.toFixed(0)}</span> | 
                            <span class="text-red-600">$${monthCashFlow.savings.payments.toFixed(0)}</span> | 
                            <span class="font-bold ${savingsNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${savingsNet.toFixed(0)}</span>
                        </td>
                        <td class="py-2 px-2 text-center text-xs">
                            <span class="text-green-600">$${monthCashFlow.investments.income.toFixed(0)}</span> | 
                            <span class="text-red-600">$${monthCashFlow.investments.payments.toFixed(0)}</span> | 
                            <span class="font-bold ${investmentsNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${investmentsNet.toFixed(0)}</span>
                        </td>
                        <td class="py-2 px-2 text-center text-xs">
                            <span class="text-green-600">$${(monthCashFlow.expenses.income + monthCashFlow.savings.income + monthCashFlow.investments.income).toFixed(0)}</span> | 
                            <span class="text-red-600">$${(monthCashFlow.expenses.payments + monthCashFlow.savings.payments + monthCashFlow.investments.payments).toFixed(0)}</span> | 
                            <span class="font-bold ${totalNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${totalNet.toFixed(0)}</span>
                        </td>
                    </tr>
                `;
            }
            
            // Add yearly totals row
            const yearExpensesNet = yearTotals.expenses.income - yearTotals.expenses.payments;
            const yearSavingsNet = yearTotals.savings.income - yearTotals.savings.payments;
            const yearInvestmentsNet = yearTotals.investments.income - yearTotals.investments.payments;
            const yearTotalNet = yearExpensesNet + yearSavingsNet + yearInvestmentsNet;
            
            tableHTML += `
                <tr class="bg-gray-100 font-bold border-t-2 border-gray-300">
                    <td class="py-3 px-2 font-bold">${currentYear} Total</td>
                    <td class="py-3 px-2 text-center text-sm">
                        <span class="text-green-600">$${yearTotals.expenses.income.toFixed(0)}</span> | 
                        <span class="text-red-600">$${yearTotals.expenses.payments.toFixed(0)}</span> | 
                        <span class="font-bold ${yearExpensesNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${yearExpensesNet.toFixed(0)}</span>
                    </td>
                    <td class="py-3 px-2 text-center text-sm">
                        <span class="text-green-600">$${yearTotals.savings.income.toFixed(0)}</span> | 
                        <span class="text-red-600">$${yearTotals.savings.payments.toFixed(0)}</span> | 
                        <span class="font-bold ${yearSavingsNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${yearSavingsNet.toFixed(0)}</span>
                    </td>
                    <td class="py-3 px-2 text-center text-sm">
                        <span class="text-green-600">$${yearTotals.investments.income.toFixed(0)}</span> | 
                        <span class="text-red-600">$${yearTotals.investments.payments.toFixed(0)}</span> | 
                        <span class="font-bold ${yearInvestmentsNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${yearInvestmentsNet.toFixed(0)}</span>
                    </td>
                    <td class="py-3 px-2 text-center text-sm">
                        <span class="text-green-600">$${(yearTotals.expenses.income + yearTotals.savings.income + yearTotals.investments.income).toFixed(0)}</span> | 
                        <span class="text-red-600">$${(yearTotals.expenses.payments + yearTotals.savings.payments + yearTotals.investments.payments).toFixed(0)}</span> | 
                        <span class="font-bold ${yearTotalNet >= 0 ? 'text-green-600' : 'text-red-600'}">$${yearTotalNet.toFixed(0)}</span>
                    </td>
                </tr>
            `;
            
            yearlyAnalysisTable.innerHTML = tableHTML;
        }

        // Initialize
        loadData();
        initializeMonth();
        updateMonthDisplay();
        updateAllDisplays();

        // Enter key handlers
        document.getElementById('incomeAmount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addIncome();
        });

        document.getElementById('expenseAmount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addExpense();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c5e7f4106bce1a',t:'MTc1NzQxMjczNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
